decluttering_templates:
  heating_template:
    default:
      - ctrlioheatingelement_id: 0
    card:
      type: grid
      square: false
      columns: 1
      cards:
        - type: heading
          icon: mdi:heating-coil
          heading: Heizstab
          heading_style: title
          badges:
            - type: entity
              show_state: true
              show_icon: true
              entity: sensor.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_status
              color: state
        - type: entities
          entities:
            - entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_defaultlevel
              name: Level
          state_color: false
          visibility:
            - condition: state
              entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
              state: manual_on
        - type: entities
          entities:
            - entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_defaultlevel
              name: Level
            - entity: time.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_endtime
              name: Endzeit
            - entity: number.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mintime
              name: Mindestlaufzeit [h]
          state_color: false
          visibility:
            - condition: state
              entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
              state: automatic
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
              name: Aus
              icon: mdi:power-standby
              styles:
                card:
                  - height: 80px
              state:
                - value: manual_off
                  color: red
                  styles:
                    card:
                      - background-color: rgba(255,0,0,0.1)
                - value: manual_off
                  operator: "!="
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: manual_off
                  entity_id: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
              name: Automatisch
              icon: mdi:auto-mode
              styles:
                card:
                  - height: 80px
              state:
                - value: automatic
                  color: green
                  styles:
                    card:
                      - background-color: rgba(0,100,255,0.1)
                - value: automatic
                  operator: "!="
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: automatic
                  entity_id: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
              name: An
              icon: mdi:power
              styles:
                card:
                  - height: 80px
              state:
                - value: manual_on
                  color: green
                  styles:
                    card:
                      - background-color: rgba(0,255,0,0.1)
                - value: manual_on
                  operator: "!="
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: manual_on
                  entity_id: select.[[system]]_ctrlioheatingelement[[ctrlioheatingelement_id]]_mode
  ess_template:
    default:
      - ctrlemergencycapacityreserve_id: 0
    card:
      type: vertical-stack
      cards:
        - type: custom:config-template-card
          variables:
            device_id: |
              temp => {return this.hass.entities[temp].device_id}
            device_model: |
              temp => {return this.hass.devices[temp].model}
          entities:
            - switch.[[system]]_ctrlemergencycapacityreserve[[ctrlemergencycapacityreserve_id]]_isreservesocenabled
          card:
            type: heading
            icon: mdi:battery-lock
            heading_style: title
            heading: ${ device_model(device_id('switch.[[system]]_ctrlemergencycapacityreserve[[ctrlemergencycapacityreserve_id]]_isreservesocenabled')) }
        - type: entities
          entities:
            - entity: switch.[[system]]_ctrlemergencycapacityreserve[[ctrlemergencycapacityreserve_id]]_isreservesocenabled
              secondary_info: none
              icon: mdi:battery-lock
          show_header_toggle: false
        - type: entities
          entities:
            - entity: number.[[system]]_ctrlemergencycapacityreserve[[ctrlemergencycapacityreserve_id]]_reservesoc
            - entity: switch.[[system]]_meta_isesschargefromgridallowed
          show_header_toggle: false
          visibility:
            - condition: state
              entity: switch.[[system]]_ctrlemergencycapacityreserve[[ctrlemergencycapacityreserve_id]]_isreservesocenabled
              state: 'on'
  evcs_template:
    default:
      - evcs_id: 0
      - ctrlevcs_id: 0
    card:
      type: vertical-stack
      cards:
        - type: custom:config-template-card
          variables:
            device_id: |
              temp => {return this.hass.entities[temp].device_id}
            device_model: |
              temp => {return this.hass.devices[temp].model}
          entities:
            - sensor.[[system]]_evcs[[evcs_id]]_state
          card:
            type: heading
            icon: mdi:ev-station
            heading_style: title
            heading: ${ device_model(device_id('sensor.[[system]]_evcs[[evcs_id]]_state')) }
        - type: entities
          entities:
            - entity: switch.[[system]]_ctrlevcs[[ctrlevcs_id]]_enabledcharging
              secondary_info: none
              icon: mdi:ev-station
          show_header_toggle: false
        - type: vertical-stack
          cards:
            - type: entities
              entities:
                - entity: sensor.[[system]]_evcs[[evcs_id]]_status
                - entity: sensor.[[system]]_evcs[[evcs_id]]_setchargepowerlimit
                - entity: sensor.[[system]]_evcs[[evcs_id]]_chargepower
                - entity: sensor.[[system]]_evcs[[evcs_id]]_energysession
              show_header_toggle: false
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                  name: >-
                    [[[ return
                    hass.localize("component.openems.entity.select.ctrlevcs_s_l_a_s_h_chargemode.state.force_charge")
                    ]]]
                  icon: mdi:target
                  styles:
                    card:
                      - height: 80px
                  state:
                    - value: force_charge
                      color: red
                      styles:
                        card:
                          - background-color: var(--paper-item-icon-active-color)
                    - value: force_charge
                      operator: '!='
                      styles:
                        name:
                          - filter: opacity(70%)
                        icon:
                          - filter: opacity(70%)
                  tap_action:
                    action: call-service
                    service: select.select_option
                    data:
                      option: force_charge
                      entity_id: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                  name: >-
                    [[[ return
                    hass.localize("component.openems.entity.select.ctrlevcs_s_l_a_s_h_chargemode.state.excess_power")
                    ]]]
                  icon: mdi:auto-mode
                  styles:
                    card:
                      - height: 80px
                  state:
                    - value: excess_power
                      color: green
                      styles:
                        card:
                          - background-color: var(--paper-item-icon-active-color)
                    - value: excess_power
                      operator: '!='
                      styles:
                        name:
                          - filter: opacity(70%)
                        icon:
                          - filter: opacity(70%)
                  tap_action:
                    action: call-service
                    service: select.select_option
                    data:
                      option: excess_power
                      entity_id: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
            - type: entities
              entities:
                - entity: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_forcechargeminpower
                  icon: mdi:arrow-collapse-up
              show_header_toggle: false
              visibility:
                - condition: state
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                  state: force_charge
            - type: horizontal-stack
              cards:
                - type: entities
                  entities:
                    - entity: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_defaultchargeminpower
                      icon: mdi:arrow-collapse-down
                  show_header_toggle: false
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_defaultchargeminpower
                  name: '[[[ return hass.localize("ui.common.disable") ]]]'
                  icon: mdi:lock-reset
                  styles:
                    card:
                      - width: 50px
                      - font-size: 10px
                  state:
                    - value: 0
                      styles:
                        card:
                          - filter: opacity(30%)
                  tap_action:
                    action: call-service
                    service: openems.update_component_config
                    data:
                      entity_id: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_defaultchargeminpower
                      value: 0
              visibility:
                - condition: state
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                  state: excess_power
            - type: horizontal-stack
              cards:
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_priority
                  name: >-
                    [[[ return
                    hass.localize("component.openems.entity.select.ctrlevcs_s_l_a_s_h_priority.state.car")
                    ]]]
                  icon: mdi:car-electric
                  styles:
                    card:
                      - height: 80px
                  state:
                    - value: car
                      color: green
                      styles:
                        card:
                          - background-color: var(--paper-item-icon-active-color)
                    - value: car
                      operator: '!='
                      styles:
                        name:
                          - filter: opacity(70%)
                        icon:
                          - filter: opacity(70%)
                  tap_action:
                    action: call-service
                    service: select.select_option
                    data:
                      option: car
                      entity_id: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_priority
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_priority
                  name: >-
                    [[[ return
                    hass.localize("component.openems.entity.select.ctrlevcs_s_l_a_s_h_priority.state.storage")
                    ]]]
                  icon: mdi:battery-medium
                  styles:
                    card:
                      - height: 80px
                  state:
                    - value: storage
                      color: green
                      styles:
                        card:
                          - background-color: var(--paper-item-icon-active-color)
                    - value: storage
                      operator: '!='
                      styles:
                        name:
                          - filter: opacity(70%)
                        icon:
                          - filter: opacity(70%)
                  tap_action:
                    action: call-service
                    service: select.select_option
                    data:
                      option: storage
                      entity_id: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_priority
              visibility:
                - condition: state
                  entity: select.[[system]]_ctrlevcs[[ctrlevcs_id]]_chargemode
                  state: excess_power
            - type: horizontal-stack
              cards:
                - type: entities
                  entities:
                    - entity: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_energysessionlimit
                      icon: mdi:arrow-collapse-up
                  show_header_toggle: false
                - type: custom:button-card
                  show_name: true
                  show_icon: true
                  entity: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_energysessionlimit
                  name: '[[[ return hass.localize("ui.common.disable") ]]]'
                  icon: mdi:lock-reset
                  styles:
                    card:
                      - width: 50px
                      - font-size: 10px
                  state:
                    - value: 0
                      styles:
                        card:
                          - filter: opacity(30%)
                  tap_action:
                    action: call-service
                    service: number.set_value
                    data:
                      value: 0
                    target:
                      entity_id: number.[[system]]_ctrlevcs[[ctrlevcs_id]]_energysessionlimit
          visibility:
            - condition: state
              entity: switch.[[system]]_ctrlevcs[[ctrlevcs_id]]_enabledcharging
              state: 'on'
  optchrg_template:
    default:
      - ctrlgridoptimizedcharge_id: 0
    card:
      type: vertical-stack
      cards:
        - type: custom:config-template-card
          variables:
            device_id: |
              temp => {return this.hass.entities[temp].device_id}
            device_model: |
              temp => {return this.hass.devices[temp].model}
          entities:
            - sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_targetminute
          card:
            type: heading
            icon: mdi:transmission-tower-import
            heading_style: title
            heading: ${ device_model(device_id('sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_targetminute')) }
        - type: entities
          entities:
            - entity: sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargestate
            - entity: sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargemaximumchargelimit
            - type: custom:template-entity-row
              icon: mdi:clock
              entity: sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_targetminute
              state: >-
                {% set x =
                as_timedelta(states.sensor.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_targetminute.state)
                | string %} {{ x[2:] }}
          show_header_toggle: false
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_mode.state.off")
                ]]]
              icon: mdi:power-standby
              styles:
                card:
                  - height: 80px
              state:
                - value: 'off'
                  color: red
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: 'off'
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: 'off'
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_mode.state.automatic")
                ]]]
              icon: mdi:auto-mode
              styles:
                card:
                  - height: 80px
              state:
                - value: automatic
                  color: green
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: automatic
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: automatic
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_mode.state.manual")
                ]]]
              icon: mdi:timeline-clock-outline
              styles:
                card:
                  - height: 80px
              state:
                - value: manual
                  color: green
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: manual
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: manual
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
        - type: horizontal-stack
          cards:
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_delaychargerisklevel.state.low")
                ]]]
              icon: mdi:speedometer-slow
              styles:
                card:
                  - height: 80px
              state:
                - value: low
                  color: green
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: low
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: low
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_delaychargerisklevel.state.medium")
                ]]]
              icon: mdi:speedometer-medium
              styles:
                card:
                  - height: 80px
              state:
                - value: medium
                  color: black
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: medium
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: medium
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
            - type: custom:button-card
              show_name: true
              show_icon: true
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
              name: >-
                [[[ return
                hass.localize("component.openems.entity.select.ctrlgridoptimizedcharge_s_l_a_s_h_delaychargerisklevel.state.high")
                ]]]
              icon: mdi:speedometer
              styles:
                card:
                  - height: 80px
              state:
                - value: high
                  color: red
                  styles:
                    card:
                      - background-color: var(--paper-item-icon-active-color)
                - value: high
                  operator: '!='
                  styles:
                    name:
                      - filter: opacity(70%)
                    icon:
                      - filter: opacity(70%)
              tap_action:
                action: call-service
                service: select.select_option
                data:
                  option: high
                  entity_id: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_delaychargerisklevel
          visibility:
            - condition: state
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
              state: automatic
        - type: entities
          entities:
            - entity: time.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_manualtargettime
          visibility:
            - condition: state
              entity: select.[[system]]_ctrlgridoptimizedcharge[[ctrlgridoptimizedcharge_id]]_mode
              state: manual
